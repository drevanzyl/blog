---
title: Cincinnati Food Safety Program
author: andre
date: '2020-03-04'
slug: cincinnati-food-safety
categories:
  - Public Health
  - R
tags:
  - Food Safety
subtitle: ''
summary: ''
authors: []
lastmod: '2020-03-04T07:53:58-05:00'
featured: no
projects: []
output:
  blogdown::html_page:
    toc: true
---


<div id="TOC">
<ul>
<li><a href="#getting-data">Getting data</a></li>
<li><a href="#column-names">Column Names</a></li>
<li><a href="#sample-of-data">Sample of Data</a></li>
<li><a href="#inspection-types">Inspection Types</a></li>
<li><a href="#cities">Cities</a></li>
<li><a href="#postal-codes">Postal Codes</a></li>
<li><a href="#complaint-discriptions">Complaint Discriptions</a></li>
<li><a href="#and-now">And now?</a></li>
<li><a href="#a-map">A Map</a></li>
<li><a href="#and-now-1">And now?</a></li>
<li><a href="#here-is-a-nice-plot.">Here is a nice plot.</a></li>
<li><a href="#build-site">Build Site</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<pre class="r"><code>knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())</code></pre>
<p>Image credit: <a href="https://unsplash.com/photos/CpkOjOcXdUY"><strong>Unsplash</strong></a></p>
<ul>
<li><p><span style="color: #fd7f6f;">Complaint</span></p></li>
<li><p><span style="color: #7eb0d5;">Routine</span></p></li>
<li><p><span style="color: #b2e061;">Initial</span></p></li>
</ul>
<pre class="r"><code>library(&quot;RSocrata&quot;)
library(tidyverse)
library(knitr)
library(DBI)</code></pre>
<div id="getting-data" class="section level1">
<h1>Getting data</h1>
<pre class="r"><code>if (Sys.info()[&quot;sysname&quot;] != &quot;Linux&quot;){
  con &lt;- dbConnect(odbc::odbc(), Server = &quot;127.0.0.1&quot;, Database = &quot;cincinnati&quot;, 
    UID = &quot;dre&quot;, PWD = &quot;password&quot;, Port = 5432, .connection_string = &quot;Driver={PostgreSQL ODBC Driver(ANSI)};&quot;, 
    timeout = 10)
  
} else {
  con &lt;- dbConnect(odbc::odbc(), Server = &quot;127.0.0.1&quot;, Database = &quot;cincinnati&quot;, 
    UID = &quot;dre&quot;, PWD = &quot;password&quot;, Port = 5432, .connection_string = &quot;Driver={PostgreSQL ANSI};&quot;, 
    timeout = 10)
}</code></pre>
</div>
<div id="column-names" class="section level1">
<h1>Column Names</h1>
<pre class="sql"><code>SELECT column_name,data_type 
FROM information_schema.columns 
WHERE table_name = &#39;foodsafety&#39;;</code></pre>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">column_name</th>
<th align="left">data_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">recordnum_license</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">license_no</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">business_name</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">address</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">city</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">state</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">postal_code</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">latitude</td>
<td align="left">numeric</td>
</tr>
<tr class="odd">
<td align="left">longitude</td>
<td align="left">numeric</td>
</tr>
<tr class="even">
<td align="left">phone_number</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">license_status</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">recordnum_insp</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">insp_type</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">insp_subtype</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">action_date</td>
<td align="left">timestamp without time zone</td>
</tr>
<tr class="even">
<td align="left">action_sequence</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">action_status</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">code</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">violation_description</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">violation_comments</td>
<td align="left">text</td>
</tr>
<tr class="odd">
<td align="left">violation_key</td>
<td align="left">text</td>
</tr>
<tr class="even">
<td align="left">last_table_update</td>
<td align="left">timestamp without time zone</td>
</tr>
<tr class="odd">
<td align="left">neighborhood</td>
<td align="left">text</td>
</tr>
</tbody>
</table>
</div>
<div id="sample-of-data" class="section level1">
<h1>Sample of Data</h1>
<pre class="sql"><code>SELECT *
FROM foodsafety
LIMIT 5</code></pre>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">recordnum_license</th>
<th align="left">license_no</th>
<th align="left">business_name</th>
<th align="left">address</th>
<th align="left">city</th>
<th align="left">state</th>
<th align="left">postal_code</th>
<th align="right">latitude</th>
<th align="right">longitude</th>
<th align="left">phone_number</th>
<th align="left">license_status</th>
<th align="left">recordnum_insp</th>
<th align="left">insp_type</th>
<th align="left">insp_subtype</th>
<th align="left">action_date</th>
<th align="left">action_sequence</th>
<th align="left">action_status</th>
<th align="left">code</th>
<th align="left">violation_description</th>
<th align="left">violation_comments</th>
<th align="left">violation_key</th>
<th align="left">last_table_update</th>
<th align="left">neighborhood</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">H200801719</td>
<td align="left">FSO-015594-C4S</td>
<td align="left">“GREEN PAPAYA”</td>
<td align="left">2942 WASSON RD</td>
<td align="left">CINCINNATI</td>
<td align="left">OH</td>
<td align="left">45209</td>
<td align="right">39.14460</td>
<td align="right">-84.43392</td>
<td align="left">513 731-0107</td>
<td align="left">LICENSE</td>
<td align="left">CFSI162337</td>
<td align="left">ROUTINE</td>
<td align="left">STANDARD INSPECTION</td>
<td align="left">2016-06-27 04:00:00</td>
<td align="left">A016810765</td>
<td align="left">Not Abated</td>
<td align="left">3717-1-03.2(M)(5)</td>
<td align="left">“3717-1-03.2(M)(5) - Violation - Wiping cloth-use limitationsContainer of wiping cloth solution is stored on the floor or in a manner that allows for contamination of food, utensils, equipment, linens and single use articles.”</td>
<td align="left">“Wiping cloth container was being stored on floor at sushi bar. Store off floor and away from food and food related items.”</td>
<td align="left">HLE160567V</td>
<td align="left">2016-06-29 02:06:27</td>
<td align="left">OAKLEY</td>
</tr>
<tr class="even">
<td align="left">H200801302</td>
<td align="left">FSO-010955-C4S</td>
<td align="left">“J &amp; W BAR-B-QUE”</td>
<td align="left">5646 MONTGOMERY RD</td>
<td align="left">CINCINNATI</td>
<td align="left">OH</td>
<td align="left">45212</td>
<td align="right">39.17684</td>
<td align="right">-84.43887</td>
<td align="left">513 751-1607</td>
<td align="left">LICENSE</td>
<td align="left">CFSI161868</td>
<td align="left">ROUTINE</td>
<td align="left">STANDARD INSPECTION</td>
<td align="left">2016-11-09 05:00:00</td>
<td align="left">A017414895</td>
<td align="left">Abated</td>
<td align="left">3717-1-04.5(A)(1)(2)</td>
<td align="left">“3717-1-04.5(A)(1)&amp;(2) - Violation - Equipment cleanliness-food contactFood-contact surfaces were dirty.”</td>
<td align="left">“Violation has been abated”</td>
<td align="left">HLE161460V</td>
<td align="left">2016-11-11 03:06:15</td>
<td align="left">PLEASANT RIDGE</td>
</tr>
<tr class="odd">
<td align="left">H201100007</td>
<td align="left">FSO-018341-C4S</td>
<td align="left">“DOODLES”</td>
<td align="left">3443 EDWARDS RD</td>
<td align="left">CINCINNATI</td>
<td align="left">OH</td>
<td align="left">45208</td>
<td align="right">39.13884</td>
<td align="right">-84.44378</td>
<td align="left">513 871-7388</td>
<td align="left">LICENSE</td>
<td align="left">CFSI123521</td>
<td align="left">ROUTINE</td>
<td align="left">STANDARD INSPECTION</td>
<td align="left">2013-02-12 05:00:00</td>
<td align="left">A011610275</td>
<td align="left">Abated On-Site</td>
<td align="left">3717-1-03.2(T)</td>
<td align="left">“3717-1-03.2(T) - Violation - Food preparation-preventing contaminationFood is not protected from environmental sources of contamination during preparation.”</td>
<td align="left">“(Corrected On-Site) Observed raw pork being stored inside of a bowl with a chipped rim. Fragments of the bowl pose a potential risk of contamination.”</td>
<td align="left">HLE090615V</td>
<td align="left">2015-03-06 02:56:43</td>
<td align="left">HYDE PARK</td>
</tr>
<tr class="even">
<td align="left">H201000089</td>
<td align="left">FSO-017922-C2S</td>
<td align="left">“BLESSED LITTLE ONE’S DAY CARE CENTER”</td>
<td align="left">5552 COLERAIN AV</td>
<td align="left">CINCINNATI</td>
<td align="left">OH</td>
<td align="left">45239</td>
<td align="right">39.19283</td>
<td align="right">-84.57179</td>
<td align="left">513 681-2273</td>
<td align="left">PAID</td>
<td align="left">CFSI123349</td>
<td align="left">ROUTINE</td>
<td align="left">STANDARD INSPECTION</td>
<td align="left">2012-05-10 04:00:00</td>
<td align="left">NA</td>
<td align="left">CLOS-NO - No Violations Found</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2015-03-06 02:56:43</td>
<td align="left">MT. AIRY</td>
</tr>
<tr class="odd">
<td align="left">H200801948</td>
<td align="left">FSO-016221-C4S</td>
<td align="left">“THE OAK TAVERN”</td>
<td align="left">3089 MADISON RD</td>
<td align="left">CINCINNATI</td>
<td align="left">OH</td>
<td align="left">45209</td>
<td align="right">39.15260</td>
<td align="right">-84.43069</td>
<td align="left">5133216258</td>
<td align="left">LICENSE</td>
<td align="left">CFSI132872</td>
<td align="left">ROUTINE</td>
<td align="left">STANDARD INSPECTION</td>
<td align="left">2013-05-22 04:00:00</td>
<td align="left">A011974537</td>
<td align="left">Abated</td>
<td align="left">3717-1-04.2(I)</td>
<td align="left">“3717-1-04.2(I) - Violation - Sanitizing solutions-testing devices.There is no test kit available for measuring the concentration of the sanitizer.”</td>
<td align="left">“Violation has been abated”</td>
<td align="left">HLE091310V</td>
<td align="left">2015-03-06 02:56:43</td>
<td align="left">OAKLEY</td>
</tr>
</tbody>
</table>
</div>
<div id="inspection-types" class="section level1">
<h1>Inspection Types</h1>
<pre class="sql"><code>SELECT DISTINCT insp_type
FROM foodsafety</code></pre>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">insp_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ROUTINE</td>
</tr>
<tr class="even">
<td align="left">COMPLAINT</td>
</tr>
<tr class="odd">
<td align="left">INITIAL</td>
</tr>
</tbody>
</table>
<pre class="r"><code>results %&gt;% head() %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">insp_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ROUTINE</td>
</tr>
<tr class="even">
<td align="left">COMPLAINT</td>
</tr>
<tr class="odd">
<td align="left">INITIAL</td>
</tr>
</tbody>
</table>
</div>
<div id="cities" class="section level1">
<h1>Cities</h1>
<pre class="sql"><code>SELECT DISTINCT city AS Cities
FROM foodsafety</code></pre>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">cities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">COLU</td>
</tr>
<tr class="odd">
<td align="left">FAIR</td>
</tr>
</tbody>
</table>
</div>
<div id="postal-codes" class="section level1">
<h1>Postal Codes</h1>
<pre class="sql"><code>SELECT DISTINCT postal_code AS postal_codes, city
FROM foodsafety</code></pre>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">postal_codes</th>
<th align="left">city</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">45217</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45227</td>
<td align="left">COLU</td>
</tr>
<tr class="odd">
<td align="left">45228</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45208</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45213</td>
<td align="left">COLU</td>
</tr>
<tr class="even">
<td align="left">45239</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45233</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45206</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45211</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45212</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45238</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45230</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45215</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45229</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45219</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45224</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45226</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45216</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45225</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45221</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45231</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45214</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45232</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45203</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45227</td>
<td align="left">FAIR</td>
</tr>
<tr class="even">
<td align="left">45202</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45204</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45205</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45227</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45220</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45209</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45223</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45213</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="odd">
<td align="left">45237</td>
<td align="left">CINCINNATI</td>
</tr>
<tr class="even">
<td align="left">45207</td>
<td align="left">CINCINNATI</td>
</tr>
</tbody>
</table>
</div>
<div id="complaint-discriptions" class="section level1">
<h1>Complaint Discriptions</h1>
<pre class="sql"><code>SELECT DISTINCT violation_description AS complaint_description
FROM foodsafety
WHERE insp_type = &#39;COMPLAINT&#39;
LIMIT 5</code></pre>
</div>
<div id="and-now" class="section level1">
<h1>And now?</h1>
<pre class="r"><code>results %&gt;% knitr::kable()</code></pre>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">complaint_description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">“3717-1-03.4(G)(1) - Violation - RTE TCS, date marking, food prepared in facilityRefrigerated, ready-to-eat, TCS food that is prepared in the food facility and held refrigerated for more than 24 hours is not properly date marked.”</td>
</tr>
<tr class="odd">
<td align="left">“3717-1-05.4(G)(1) - Violation - Refuse: Storage area: Not sufficentRefuse is stored in an area insufficient to handle the amount of waste.”</td>
</tr>
<tr class="even">
<td align="left">“3717-1-03.1(A)(1) - Violation - Sources compliance with food lawFood is from an unapproved source.”</td>
</tr>
<tr class="odd">
<td align="left">“3717-1-03.4(F)(2) - Violation - TCS-cold holding-shell eggsRaw shell eggs are not maintained at =45° F.”</td>
</tr>
</tbody>
</table>
</div>
<div id="a-map" class="section level1">
<h1>A Map</h1>
<p>Will it go away?</p>
<pre class="sql"><code>ALTER TABLE foodsafety
  ALTER COLUMN &quot;latitude&quot; TYPE NUMERIC(14, 11) 
    USING (&quot;latitude&quot;::NUMERIC(14,11)),
  ALTER COLUMN &quot;longitude&quot; TYPE NUMERIC(14, 11) 
    USING (&quot;longitude&quot;::NUMERIC(14,11));</code></pre>
</div>
<div id="and-now-1" class="section level1">
<h1>And now?</h1>
<pre class="sql"><code>SELECT  DISTINCT(postal_code), latitude, longitude, insp_type
FROM foodsafety</code></pre>
</div>
<div id="here-is-a-nice-plot." class="section level1">
<h1>Here is a nice plot.</h1>
</div>
<div id="build-site" class="section level1">
<h1>Build Site</h1>
<pre class="r"><code>library(leaflet)
pal &lt;- colorFactor(c(&quot;#fd7f6f&quot;, &quot;#7eb0d5&quot;, &quot;#b2e061&quot;), domain = c(&quot;COMPLAINT&quot;, &quot;ROUTINE&quot;, &quot;INITIAL&quot;))

leafMap &lt;- leaflet(results) %&gt;% addTiles() %&gt;%
  addCircleMarkers(
    lng=~longitude, lat=~latitude,
    color = ~pal(insp_type),
    stroke = FALSE, fillOpacity = 0.5,
    clusterOptions = markerClusterOptions()
  ) %&gt;% addProviderTiles(providers$Esri.NatGeoWorldMap)</code></pre>
<pre><code>## Warning in validateCoords(lng, lat, funcName): Data contains 2 rows with either
## missing or invalid lat/lon values and will be ignored</code></pre>
<pre class="r"><code>library(htmlwidgets)
library(htmltools)

currentWD &lt;- getwd()
dir.create(&quot;static/leaflet&quot;, showWarnings = FALSE)
setwd(&quot;static/leaflet&quot;)
saveWidget(leafMap, &quot;leafMap.html&quot;)
setwd(currentWD)</code></pre>
<p>The html that was saved with the saveWidget function can be called with the iframe html tag.</p>
<iframe seamless src="/leaflet/leafMap.html" width="100%" height="500">
</iframe>
<ul>
<li><span style="color: #fd7f6f;">Complaint</span></li>
<li><span style="color: #7eb0d5;">Routine</span></li>
<li><span style="color: #b2e061;">Initial</span></li>
</ul>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><a href="https://www.cincinnati-oh.gov/health/cincinnati-health-department-programs/food-safety-and-inspections-program/">Food Safety and Inspections</a></p>
<p><a href="https://data.cincinnati-oh.gov/Thriving-Neighborhoods/Cincinnati-Food-Safety-Program/rg6p-b3h3">Cincinnati Food Safety Program</a></p>
<p><a href="https://dev.socrata.com/foundry/data.cincinnati-oh.gov/rg6p-b3h3">SODA: Cincinnati Food Safety Program</a></p>
<p><a href="https://db.rstudio.com/getting-started/connect-to-database/">Connect to a Database</a></p>
<p><a href="https://db.rstudio.com/">Databases using R</a></p>
<p><a href="https://stackoverflow.com/questions/20194806/how-to-get-a-list-column-names-and-datatype-of-a-table-in-postgresql">How to get a list column names and datatype of a table in PostgreSQL?</a></p>
<p><a href="https://support.socrata.com/hc/en-us/articles/115011432428">Open A Socrata Dataset In Microsoft Power BI</a></p>
<p><a href="https://www.w3schools.com/sql/default.asp">SQL Tutorial</a></p>
<p><a href="https://rstudio.github.io/leaflet/">Leaflet for R</a></p>
<p><a href="https://dba.stackexchange.com/questions/78580/postgres-columns-of-latitude-and-longitude-from-varchar-to-numeric">Postgres columns of latitude and longitude from varchar to numeric</a></p>
<p><a href="https://waterdata.usgs.gov/blog/leaflet/">Using Leaflet and htmlwidgets in a Hugo-generated page</a></p>
</div>
